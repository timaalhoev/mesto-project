(()=>{"use strict";var e=null,t="https://nomoreparties.co/v1/plus-cohort7/cards",n="https://nomoreparties.co/v1/plus-cohort7/users/me",o="https://nomoreparties.co/v1/plus-cohort7/cards/likes",r="3d57eda9-7790-4f7a-bd35-cb564682d3fd",c=function(e){g.textContent=e.name,k.textContent=e.about,j.setAttribute("src",e.avatar)},u=document.querySelector(".popup_image"),a=document.querySelector(".popup_image .popup__text"),i=document.querySelector(".popup_image .popup__picture"),l=document.getElementById("template__location"),s=document.querySelector(".locations__row");function p(e,t){"at_first"===t?s.prepend(e):s.append(e)}function d(n){var c=l.content.cloneNode(!0),s=c.querySelector(".location__images");s.src=n.link,s.alt=n.name,s.addEventListener("click",(function(){z(u),i.setAttribute("src",n.link),i.setAttribute("alt",n.name),a.textContent=n.name})),c.querySelector(".location__title").textContent=n.name;var p=c.querySelector(".location__like"),d=c.querySelector(".location__like-count");0!==n.likes.length&&n.likes.forEach((function(t){e===t._id&&p.classList.add("active")})),d.textContent=n.likes.length,p.addEventListener("click",(function(e){var t;p.classList.contains("active")?(t=n._id,fetch("".concat(o,"/").concat(t),{method:"DELETE",headers:{authorization:r}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(e){d.textContent=e.likes.length,p.classList.remove("active")})).catch((function(e){return console.log(e)})):function(e){return fetch("".concat(o,"/").concat(e),{method:"PUT",headers:{authorization:r}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(n._id).then((function(e){d.textContent=e.likes.length,p.classList.add("active")})).catch((function(e){return console.log(e)}))}));var f=c.querySelector(".location__delete");return n.owner._id===e?f.addEventListener("click",(function(e){var o;(o=n._id,fetch("".concat(t,"/").concat(o),{method:"DELETE",headers:{authorization:r}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))).then((function(){e.target.closest(".location").remove()}))})):f.remove(),c}var f=function(e,t){e.classList.add(t.buttonDesabledClass),e.disabled=!0};function m(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function _(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var v=document.querySelector(".field__label"),y=document.querySelector(".field__image"),h=document.querySelector(".popup__button_place"),b=document.querySelector(".popup__button_user"),S=document.querySelector(".field__name"),q=document.querySelector(".field__job"),g=document.querySelector(".profile__title"),k=document.querySelector(".profile__subtitle"),j=document.querySelector(".profile__image"),E=document.querySelector(".popup_user"),L=(document.querySelector(".form__user"),document.querySelector(".popup_place")),C=document.querySelector(".form__place"),O=document.querySelector(".popup_avatar"),P=document.querySelector(".form__avatar"),x=document.querySelector(".profile__button_act_avatar"),w=document.querySelector(".popup__button-avatar"),D=document.querySelector(".form__input-avatar");function N(e,t){t.textContent=e?"Сохранение...":"Сохранить"}function A(e){e.target.classList.remove("popup_opened")}function T(e){var t=e.key,n=document.querySelector(".popup_opened");"Escape"===t&&n&&F(n)}function z(e){e.classList.add("popup_opened"),e.addEventListener("click",A),document.addEventListener("keydown",T)}function F(e){e.classList.remove("popup_opened"),e.removeEventListener("click",A),document.removeEventListener("keydown",T)}var I,J=document.querySelector(".profile__edit-button"),B=document.querySelector(".profile__button"),H=document.querySelector(".popup_user .popup__close"),M=document.querySelector(".popup_place .popup__close"),U=document.querySelector(".popup_image .popup__close"),G=document.querySelector(".popup_avatar .popup__close");document.getElementById("template__location"),document.querySelector(".popup__button"),J.addEventListener("click",(function(){S.value=g.textContent,q.value=k.textContent,z(E)})),H.addEventListener("click",(function(){return F(E)})),B.addEventListener("click",(function(){return z(L)})),M.addEventListener("click",(function(){return F(L)})),U.addEventListener("click",(function(){return F(u)})),x.addEventListener("click",(function(){return z(O)})),G.addEventListener("click",(function(){return F(O)})),I={formSelector:".popup__form",userFormName:"change_user",placeFormName:"place",avatarFormName:"avatar",inputSelector:".popup__field",errorClass:"text-input-error",inputInvalidClass:"popup__field_invalid",buttonSelector:".popup__button",buttonDesabledClass:"popup__button_disabled"},Array.from(document.querySelectorAll(I.formSelector)).forEach((function(o){o.addEventListener("submit",(function(o){o.preventDefault(),o.target.name===I.placeFormName?function(e){N(!0,h),function(e,n){return fetch(t,{method:"POST",headers:{authorization:r,"Content-Type":"application/json"},body:JSON.stringify({name:e,link:n})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}))}(v.value,y.value).then((function(e){var t=d(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?m(Object(n),!0).forEach((function(t){_(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):m(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e));p(t,"at_first")})).finally((function(){N(!1,h),C.reset(),F(L),f(h,e)}))}(I):o.target.name===I.userFormName?function(t){N(!0,b),function(t,o){return fetch(n,{method:"PATCH",headers:{authorization:r,"Content-Type":"application/json"},body:JSON.stringify({name:t,about:o})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(t){e=t._id,c(t)}))}(S.value,q.value).catch((function(e){return console.log("Ошибка: ".concat(e))})).finally((function(){N(!1,b),F(E),f(b,t)}))}(I):o.target.name===I.avatarFormName&&function(t){var o;N(!0,w),(o=D.value,fetch("".concat(n,"/avatar"),{method:"PATCH",headers:{authorization:r,"Content-Type":"application/json"},body:JSON.stringify({avatar:"".concat(o)})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(t){e=t._id,c(t)}))).catch((function(e){return console.log("Ошибка: ".concat(e))})).finally((function(){N(!1,w),P.reset(),F(O),f(w,t)}))}(I)})),function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector));n.forEach((function(o){o.addEventListener("input",(function(){!function(e,t,n){var o=e.querySelector("#".concat(t.id,"-error"));t.validity.valid?function(e,t,n){e.classList.remove(n.inputInvalidClass),e.classList.remove(n.errorClass),t.textContent=""}(t,o,n):function(e,t,n,o){e.classList.add(o.inputInvalidClass),e.classList.add(o.errorClass),t.textContent=n}(t,o,t.validationMessage,n)}(e,o,t),function(e,t,n){var o=e.querySelector(n.buttonSelector);!function(e){return e.some((function(e){return!e.validity.valid}))}(t)?function(e,t){e.classList.remove(t.buttonDesabledClass),e.disabled=!1}(o,n):f(o,n)}(e,n,t)}))}))}(o,I)})),fetch(n,{headers:{authorization:r}}).then((function(e){if(e.ok)return e.json();Promise.reject("Ошибка: ".concat(e.status))})).then((function(t){e=t._id,c(t)})),fetch(t,{headers:{authorization:r}}).then((function(e){if(e.ok)return e.json();Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){return e.forEach((function(e){return p(d(e))}))}))})();